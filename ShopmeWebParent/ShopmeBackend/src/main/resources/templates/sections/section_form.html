<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <div th:replace="~{fragments :: page_head(${pageTitle}, 'tag')}"></div>
    <th:block th:if="${sectionType == 'text'}">
        <link rel="stylesheet" type="text/css" th:href="@{/richtext/richtext.min.css}">
        <script type="text/javascript" th:src="@{/richtext/jquery.richtext.js}"></script>
        <script type="text/javascript" th:src="@{/richtext/jquery.richtext.min.js}"></script>
    </th:block>
</head>
<body>
<div class="container-fluid">
    <div th:replace="~{navigation :: menu}">...</div>
    <div class="text-start">
        <h2>Home Page Customization | Add [[${sectionTitle}]] Section</h2>
    </div>

    <th:block th:if="${sectionType == 'all_categories'}">
        <p>This kind of section will display all categories. There should be only one section of this type</p>
    </th:block>

    <form th:action="@{/sections/save}" method="post" th:object="${section}" style="max-width: 60%; margin: 0 auto;" onsubmit="return processBeforeSubmit();">
        <div class="border border-secondary rounded p-3">
            <input type="hidden" th:field="*{id}">
            <input type="hidden" th:field="*{sectionType}">

            <div class="form-group row">
                <label class="col-form-label col-sm-4 my-auto">Heading:</label>
                <div class="col-sm-8">
                    <input class="form-control" type="text" th:field="*{heading}" required minlength="5" maxlength="200">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-form-label col-sm-4 my-auto">Description:</label>
                <div class="col-sm-8">
                    <textarea rows="4" class="form-control" type="text" th:field="*{description}" id="description"></textarea>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-form-label col-sm-4 my-auto">Enabled:</label>
                <div class="col-sm-8 my-auto">
                    <input type="checkbox" th:field="*{enabled}">
                </div>
            </div>


            <th:block th:if="${sectionType == 'selected_products'}">
                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Products:</label>
                    <div class="col-sm-8">
                            <a class="btn btn-success" id="linkAddProduct" th:href="@{/sections/search_product}">Add a Product</a>
                    </div>
                </div>

                <div th:replace="~{sections/section_form_products :: content}">...</div>
            </th:block>

            <th:block th:if="${sectionType == 'selected_categories'}">
                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Categories</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 250px" size="4" id="dropDownCategories">
                        </select>
                        <button type="button" class="btn btn-secondary mt-3" id="chooseCategory">Add Category</button>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Chosen categories:</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 200px" size="3" id="dropDownChosenCategories" th:field="*{sectionCategories}" multiple>
                            <option th:each="section : ${section.sectionCategories}" th:with="category = ${section.category}" th:value="${category.id}">[[${category.name}]]</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-8">
                        <a class="fas fa-trash icon-dark text-decoration-none link-remove--category" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-up icon-dark text-decoration-none link-move-up--category" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-down icon-dark text-decoration-none link-move-down--category" href=""></a>
                    </div>
                </div>
            </th:block>

            <th:block th:if="${sectionType == 'selected_brands'}">
                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Brands</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 250px" size="4" id="dropDownBrands">
                        </select>
                        <button type="button" class="btn btn-secondary mt-3" id="chooseBrand">Add Brand</button>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Chosen brands:</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 200px" size="3" id="dropDownChosenBrands" th:field="*{sectionBrands}" multiple>
                           <option th:each="section : ${section.sectionBrands}" th:with="brand = ${section.brand}" th:value="${brand.id}">[[${brand.name}]]</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-8">
                        <a class="fas fa-trash icon-dark text-decoration-none link-remove--brand" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-up icon-dark text-decoration-none link-move-up--brand" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-down icon-dark text-decoration-none link-move-down--brand" href=""></a>
                    </div>
                </div>
            </th:block>


            <th:block th:if="${sectionType == 'selected_articles'}">
                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Articles</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 250px" size="4" id="dropDownArticles">
                        </select>
                        <button type="button" class="btn btn-secondary mt-3" id="chooseArticle">Add Article</button>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-form-label col-sm-4 my-auto">Chosen Articles:</label>
                    <div class="col-sm-8">
                        <select class="form-control" style="height: 200px" size="3" id="dropDownChosenArticles" th:field="*{sectionArticles}" multiple>
                            <option th:each="section : ${section.sectionArticles}" th:with="article = ${section.article}" th:value="${article.id}">[[${article.title}]]</option>
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-8">
                        <a class="fas fa-trash icon-dark text-decoration-none link-remove--article" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-up icon-dark text-decoration-none link-move-up--article" href=""></a>
                        &nbsp;
                        &nbsp;
                        <a class="fas fa-chevron-down icon-dark text-decoration-none link-move-down--article" href=""></a>
                    </div>
                </div>
            </th:block>


            <div class="text-center">
                <input type="submit" value="Save" class="btn btn-primary m-3" />
                <input type="button" value="Cancel" class="btn btn-secondary" id="buttonCancel" />
            </div>
        </div>
    </form>

    <div th:replace="~{sections/add_product_modal :: content}"></div>
    <div th:replace="~{modal_fragments :: modal_dialog}">...</div>
</div>
<script type="text/javascript">
    let moduleURL = "[[@{/sections}]]";
    let contextPath = "[[@{/}]]";
    let sectionType = "[[${sectionType}]]";

    let sectionProducts = "[[${section}]]";

    console.log(sectionProducts);

    console.log(sectionType);

<!--    category section -->
    let categoriesModuleURL = "[[@{/categories}]]";
    let dropDownCategories = $("#dropDownCategories");
    let dropDownChosenCategories = $("#dropDownChosenCategories");

<!--    article section -->
    let articlesModuleURL = "[[@{/articles}]]";
    let dropDownArticles = $("#dropDownArticles");
    let dropDownChosenArticles = $("#dropDownChosenArticles");

<!--    brand section -->
    let brandsModuleURL = "[[@{/brands}]]";
    let dropDownBrands = $("#dropDownBrands");
    let dropDownChosenBrands = $("#dropDownChosenBrands");

    let dropDownChosenDOM;
    let buttonId;
    let label;

    $(document).ready(function() {
        if(sectionType === "selected_categories") {
            loadCategories();
            dropDownChosenDOM = dropDownChosenCategories['0'];
            buttonId = '#chooseCategory';
            label = "category";
        }
        else if(sectionType === "selected_articles") {
            loadArticles();
             dropDownChosenDOM = dropDownChosenArticles['0'];
             buttonId = '#chooseArticle';
             label = "article";
        }
        else if(sectionType === "selected_brands") {
            loadBrands();
            dropDownChosenDOM = dropDownChosenBrands['0'];
            buttonId = '#chooseBrand';
             label = "brand";
        }
        else if(sectionType === "text") {
            $("#description").richText();
        }

          $(buttonId).on("click", function(e) {
                e.preventDefault();
                if(buttonId === '#chooseCategory') {
                      let value = dropDownCategories.val();
                      addChosenItem(value, dropDownChosenCategories);
                }
                else if(buttonId === '#chooseArticle') {
                     let value = dropDownArticles.val();
                     addChosenItem(value, dropDownChosenArticles);
                }
                else if(buttonId === '#chooseBrand') {
                    let value = dropDownBrands.val();
                     addChosenItem(value, dropDownChosenBrands);
                }
          });

          let classMoveUp = '.link-move-up--'  + label;
          let classMoveDown = '.link-move-down--' +label;
          let classRemove = '.link-remove--' + label;


          $(classMoveUp).on("click", function(e) {
                e.preventDefault();
                moveUp();
         })

          $(classMoveDown).on("click", function(e) {
                e.preventDefault();
               moveDown();
         })

         $(classRemove).on("click", function(e) {
                e.preventDefault();
               removeChosenItem();
         });
    }) ;

     function processBeforeSubmit() {
        dropDownChosenCategories.find("option").prop("selected", true);
        dropDownChosenBrands.find("option").prop("selected", true);
        dropDownChosenArticles.find("option").prop("selected", true);
        return true;
     }
</script>
<script th:src="@{/js/common_form.js}"></script>
<script th:src="@{/js/common_section_form.js}"></script>
<script th:src="@{/js/section_form_product.js}"></script>
</body>
</html>